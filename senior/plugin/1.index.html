<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>一.plugin的实现 | Webpack学习笔记</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/web-webpack/home.svg">
    <link rel="manifest" href="/web-webpack/manifest.json">
    <script src="/web-webpack/dll/vendor.dll.js"></script>
    <script src="https://webapi.amap.com/maps?v=2.0&amp;key=46c9ed4e2d25a0e0ee7c883fd5b1a0c8"></script>
    <script src="https://webapi.amap.com/ui/1.1/main.js?v=1.1.1"></script>
    <meta name="description" content="个人总结的vuepress学习技术文档-语法">
    <meta name="keywords" content="vuepress,最新技术文档,vuepress语法,markdown语法">
    
    <link rel="preload" href="/web-webpack/assets/css/0.styles.395e892c.css" as="style"><link rel="preload" href="/web-webpack/assets/js/app.a2f8f17b.js" as="script"><link rel="preload" href="/web-webpack/assets/js/2.3b648fd0.js" as="script"><link rel="preload" href="/web-webpack/assets/js/56.854608ed.js" as="script"><link rel="preload" href="/web-webpack/assets/js/3.7ee031b5.js" as="script"><link rel="prefetch" href="/web-webpack/assets/js/10.0dcf4a13.js"><link rel="prefetch" href="/web-webpack/assets/js/100.2b833e54.js"><link rel="prefetch" href="/web-webpack/assets/js/101.5404aa94.js"><link rel="prefetch" href="/web-webpack/assets/js/102.e91e964a.js"><link rel="prefetch" href="/web-webpack/assets/js/103.15ca91ba.js"><link rel="prefetch" href="/web-webpack/assets/js/104.13af7b05.js"><link rel="prefetch" href="/web-webpack/assets/js/105.443c276b.js"><link rel="prefetch" href="/web-webpack/assets/js/106.8f084a6d.js"><link rel="prefetch" href="/web-webpack/assets/js/107.b51a3c1a.js"><link rel="prefetch" href="/web-webpack/assets/js/108.9f4c399a.js"><link rel="prefetch" href="/web-webpack/assets/js/109.a856c236.js"><link rel="prefetch" href="/web-webpack/assets/js/11.8ceaa657.js"><link rel="prefetch" href="/web-webpack/assets/js/110.dfeb0286.js"><link rel="prefetch" href="/web-webpack/assets/js/111.da626c91.js"><link rel="prefetch" href="/web-webpack/assets/js/112.7ec88ecc.js"><link rel="prefetch" href="/web-webpack/assets/js/113.253bff4e.js"><link rel="prefetch" href="/web-webpack/assets/js/114.a539230f.js"><link rel="prefetch" href="/web-webpack/assets/js/115.5d917081.js"><link rel="prefetch" href="/web-webpack/assets/js/116.f3fc4fcc.js"><link rel="prefetch" href="/web-webpack/assets/js/117.ac5cf54f.js"><link rel="prefetch" href="/web-webpack/assets/js/118.2187a3ac.js"><link rel="prefetch" href="/web-webpack/assets/js/119.edc97f72.js"><link rel="prefetch" href="/web-webpack/assets/js/12.073a5596.js"><link rel="prefetch" href="/web-webpack/assets/js/120.cddd98b4.js"><link rel="prefetch" href="/web-webpack/assets/js/121.5340af3d.js"><link rel="prefetch" href="/web-webpack/assets/js/122.26a5fda8.js"><link rel="prefetch" href="/web-webpack/assets/js/123.503735a4.js"><link rel="prefetch" href="/web-webpack/assets/js/124.7e2281e5.js"><link rel="prefetch" href="/web-webpack/assets/js/125.9d9166ec.js"><link rel="prefetch" href="/web-webpack/assets/js/13.8f78fa75.js"><link rel="prefetch" href="/web-webpack/assets/js/14.609d78d9.js"><link rel="prefetch" href="/web-webpack/assets/js/15.bcc6243d.js"><link rel="prefetch" href="/web-webpack/assets/js/16.c7ba280c.js"><link rel="prefetch" href="/web-webpack/assets/js/17.b6340296.js"><link rel="prefetch" href="/web-webpack/assets/js/18.3f106d33.js"><link rel="prefetch" href="/web-webpack/assets/js/19.d13def4a.js"><link rel="prefetch" href="/web-webpack/assets/js/20.4f02f869.js"><link rel="prefetch" href="/web-webpack/assets/js/21.c6c921b5.js"><link rel="prefetch" href="/web-webpack/assets/js/22.32115ac4.js"><link rel="prefetch" href="/web-webpack/assets/js/23.61aa2dcb.js"><link rel="prefetch" href="/web-webpack/assets/js/24.fefb6299.js"><link rel="prefetch" href="/web-webpack/assets/js/25.d2360f59.js"><link rel="prefetch" href="/web-webpack/assets/js/26.d809a8f1.js"><link rel="prefetch" href="/web-webpack/assets/js/27.5ceb8421.js"><link rel="prefetch" href="/web-webpack/assets/js/28.0a08b3f6.js"><link rel="prefetch" href="/web-webpack/assets/js/29.be64ab15.js"><link rel="prefetch" href="/web-webpack/assets/js/30.9e066c21.js"><link rel="prefetch" href="/web-webpack/assets/js/31.4ddf30d4.js"><link rel="prefetch" href="/web-webpack/assets/js/32.51dd8b1e.js"><link rel="prefetch" href="/web-webpack/assets/js/33.f160a678.js"><link rel="prefetch" href="/web-webpack/assets/js/34.1225c0d6.js"><link rel="prefetch" href="/web-webpack/assets/js/35.289a226a.js"><link rel="prefetch" href="/web-webpack/assets/js/36.7f42109f.js"><link rel="prefetch" href="/web-webpack/assets/js/37.dac31eb6.js"><link rel="prefetch" href="/web-webpack/assets/js/38.a471f794.js"><link rel="prefetch" href="/web-webpack/assets/js/39.95e9a065.js"><link rel="prefetch" href="/web-webpack/assets/js/4.5d366182.js"><link rel="prefetch" href="/web-webpack/assets/js/40.7911058f.js"><link rel="prefetch" href="/web-webpack/assets/js/41.6f50a1f7.js"><link rel="prefetch" href="/web-webpack/assets/js/42.71117b2f.js"><link rel="prefetch" href="/web-webpack/assets/js/43.1e8cfd86.js"><link rel="prefetch" href="/web-webpack/assets/js/44.b8226623.js"><link rel="prefetch" href="/web-webpack/assets/js/45.47213c97.js"><link rel="prefetch" href="/web-webpack/assets/js/46.496c35e1.js"><link rel="prefetch" href="/web-webpack/assets/js/47.7ee5c66d.js"><link rel="prefetch" href="/web-webpack/assets/js/48.bd72256f.js"><link rel="prefetch" href="/web-webpack/assets/js/49.df9082b4.js"><link rel="prefetch" href="/web-webpack/assets/js/5.dc45a82e.js"><link rel="prefetch" href="/web-webpack/assets/js/50.19fbb54b.js"><link rel="prefetch" href="/web-webpack/assets/js/51.f6c1b0f8.js"><link rel="prefetch" href="/web-webpack/assets/js/52.cba0be09.js"><link rel="prefetch" href="/web-webpack/assets/js/53.32aef032.js"><link rel="prefetch" href="/web-webpack/assets/js/54.8b683923.js"><link rel="prefetch" href="/web-webpack/assets/js/55.d961bc4f.js"><link rel="prefetch" href="/web-webpack/assets/js/57.7705547b.js"><link rel="prefetch" href="/web-webpack/assets/js/58.96c482e0.js"><link rel="prefetch" href="/web-webpack/assets/js/59.00955698.js"><link rel="prefetch" href="/web-webpack/assets/js/6.e791c740.js"><link rel="prefetch" href="/web-webpack/assets/js/60.235eafac.js"><link rel="prefetch" href="/web-webpack/assets/js/61.2d6f7401.js"><link rel="prefetch" href="/web-webpack/assets/js/62.929be4b5.js"><link rel="prefetch" href="/web-webpack/assets/js/63.42cd3f5a.js"><link rel="prefetch" href="/web-webpack/assets/js/64.d94370b9.js"><link rel="prefetch" href="/web-webpack/assets/js/65.91cf28fb.js"><link rel="prefetch" href="/web-webpack/assets/js/66.fdd38e2f.js"><link rel="prefetch" href="/web-webpack/assets/js/67.c89e8db8.js"><link rel="prefetch" href="/web-webpack/assets/js/68.85e52490.js"><link rel="prefetch" href="/web-webpack/assets/js/69.8e38d99b.js"><link rel="prefetch" href="/web-webpack/assets/js/7.ce68948c.js"><link rel="prefetch" href="/web-webpack/assets/js/70.576a406f.js"><link rel="prefetch" href="/web-webpack/assets/js/71.3a751f67.js"><link rel="prefetch" href="/web-webpack/assets/js/72.a983127b.js"><link rel="prefetch" href="/web-webpack/assets/js/73.fc2c6e60.js"><link rel="prefetch" href="/web-webpack/assets/js/74.f199345e.js"><link rel="prefetch" href="/web-webpack/assets/js/75.31ce2d49.js"><link rel="prefetch" href="/web-webpack/assets/js/76.e989da2a.js"><link rel="prefetch" href="/web-webpack/assets/js/77.11c9f890.js"><link rel="prefetch" href="/web-webpack/assets/js/78.e9b3a02d.js"><link rel="prefetch" href="/web-webpack/assets/js/79.d038a1a5.js"><link rel="prefetch" href="/web-webpack/assets/js/8.ef3010dc.js"><link rel="prefetch" href="/web-webpack/assets/js/80.57c5e1e9.js"><link rel="prefetch" href="/web-webpack/assets/js/81.d44560c5.js"><link rel="prefetch" href="/web-webpack/assets/js/82.3f1c9189.js"><link rel="prefetch" href="/web-webpack/assets/js/83.efd39bfc.js"><link rel="prefetch" href="/web-webpack/assets/js/84.a6c28532.js"><link rel="prefetch" href="/web-webpack/assets/js/85.34d2750d.js"><link rel="prefetch" href="/web-webpack/assets/js/86.f628d7b7.js"><link rel="prefetch" href="/web-webpack/assets/js/87.b4ae1559.js"><link rel="prefetch" href="/web-webpack/assets/js/88.ddc8d7c0.js"><link rel="prefetch" href="/web-webpack/assets/js/89.2690c791.js"><link rel="prefetch" href="/web-webpack/assets/js/9.d351b673.js"><link rel="prefetch" href="/web-webpack/assets/js/90.280111e1.js"><link rel="prefetch" href="/web-webpack/assets/js/91.1baca8f5.js"><link rel="prefetch" href="/web-webpack/assets/js/92.cfa8c42e.js"><link rel="prefetch" href="/web-webpack/assets/js/93.5a4c6ae6.js"><link rel="prefetch" href="/web-webpack/assets/js/94.0c23f801.js"><link rel="prefetch" href="/web-webpack/assets/js/95.40093bca.js"><link rel="prefetch" href="/web-webpack/assets/js/96.d5ef752b.js"><link rel="prefetch" href="/web-webpack/assets/js/97.5ed3a4be.js"><link rel="prefetch" href="/web-webpack/assets/js/98.01f99946.js"><link rel="prefetch" href="/web-webpack/assets/js/99.9e12f908.js">
    <link rel="stylesheet" href="/web-webpack/assets/css/0.styles.395e892c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/web-webpack/" class="home-link router-link-active"><!----> <span class="site-name">Webpack学习笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="基础知识" class="dropdown-title"><span class="title">基础知识</span> <span class="arrow down"></span></button> <button type="button" aria-label="基础知识" class="mobile-dropdown-title"><span class="title">基础知识</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/web-webpack/base/function/1.index.html" class="nav-link">
  一.基础功能
</a></li><li class="dropdown-item"><!----> <a href="/web-webpack/base/config/1.打包多页应用.html" class="nav-link">
  二.常见配置
</a></li><li class="dropdown-item"><!----> <a href="/web-webpack/base/plugin/1.index.html" class="nav-link">
  三.plugin使用
</a></li><li class="dropdown-item"><!----> <a href="/web-webpack/base/loader/1.index.html" class="nav-link">
  四.loader使用
</a></li><li class="dropdown-item"><!----> <a href="/web-webpack/base/optimize/1.noParse.html" class="nav-link">
  五.性能优化
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="高级知识" class="dropdown-title"><span class="title">高级知识</span> <span class="arrow down"></span></button> <button type="button" aria-label="高级知识" class="mobile-dropdown-title"><span class="title">高级知识</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/web-webpack/senior/loader/1.index.html" class="nav-link">
  一.loader实现
</a></li><li class="dropdown-item"><!----> <a href="/web-webpack/senior/plugin/1.index.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  二.plugin实现
</a></li><li class="dropdown-item"><!----> <a href="/web-webpack/senior/tapable/1.index.html" class="nav-link">
  三.tapable实现
</a></li><li class="dropdown-item"><!----> <a href="/web-webpack/senior/write/1.writeByHand.html" class="nav-link">
  四.webpack简易实现
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="源码知识" class="dropdown-title"><span class="title">源码知识</span> <span class="arrow down"></span></button> <button type="button" aria-label="源码知识" class="mobile-dropdown-title"><span class="title">源码知识</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/web-webpack/source/webpack/1.index.html" class="nav-link">
  一.webpack
</a></li><li class="dropdown-item"><!----> <a href="/web-webpack/source/plugin/1.index.html" class="nav-link">
  二.plugin
</a></li><li class="dropdown-item"><!----> <a href="/web-webpack/source/loader/1.index.html" class="nav-link">
  三.loader
</a></li></ul></div></div> <a href="https://github.com/zhoubichuan/web-webpack" target="_blank" rel="noopener noreferrer" class="repo-link">
    查看源码
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="基础知识" class="dropdown-title"><span class="title">基础知识</span> <span class="arrow down"></span></button> <button type="button" aria-label="基础知识" class="mobile-dropdown-title"><span class="title">基础知识</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/web-webpack/base/function/1.index.html" class="nav-link">
  一.基础功能
</a></li><li class="dropdown-item"><!----> <a href="/web-webpack/base/config/1.打包多页应用.html" class="nav-link">
  二.常见配置
</a></li><li class="dropdown-item"><!----> <a href="/web-webpack/base/plugin/1.index.html" class="nav-link">
  三.plugin使用
</a></li><li class="dropdown-item"><!----> <a href="/web-webpack/base/loader/1.index.html" class="nav-link">
  四.loader使用
</a></li><li class="dropdown-item"><!----> <a href="/web-webpack/base/optimize/1.noParse.html" class="nav-link">
  五.性能优化
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="高级知识" class="dropdown-title"><span class="title">高级知识</span> <span class="arrow down"></span></button> <button type="button" aria-label="高级知识" class="mobile-dropdown-title"><span class="title">高级知识</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/web-webpack/senior/loader/1.index.html" class="nav-link">
  一.loader实现
</a></li><li class="dropdown-item"><!----> <a href="/web-webpack/senior/plugin/1.index.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  二.plugin实现
</a></li><li class="dropdown-item"><!----> <a href="/web-webpack/senior/tapable/1.index.html" class="nav-link">
  三.tapable实现
</a></li><li class="dropdown-item"><!----> <a href="/web-webpack/senior/write/1.writeByHand.html" class="nav-link">
  四.webpack简易实现
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="源码知识" class="dropdown-title"><span class="title">源码知识</span> <span class="arrow down"></span></button> <button type="button" aria-label="源码知识" class="mobile-dropdown-title"><span class="title">源码知识</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/web-webpack/source/webpack/1.index.html" class="nav-link">
  一.webpack
</a></li><li class="dropdown-item"><!----> <a href="/web-webpack/source/plugin/1.index.html" class="nav-link">
  二.plugin
</a></li><li class="dropdown-item"><!----> <a href="/web-webpack/source/loader/1.index.html" class="nav-link">
  三.loader
</a></li></ul></div></div> <a href="https://github.com/zhoubichuan/web-webpack" target="_blank" rel="noopener noreferrer" class="repo-link">
    查看源码
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/web-webpack/senior/plugin/1.index.html" aria-current="page" class="active sidebar-link">一.plugin的实现</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/web-webpack/senior/plugin/1.index.html#_1-一个简单的-plugin" class="sidebar-link">1.一个简单的 plugin</a></li><li class="sidebar-sub-header"><a href="/web-webpack/senior/plugin/1.index.html#_2-开发和调试" class="sidebar-link">2.开发和调试</a></li><li class="sidebar-sub-header"><a href="/web-webpack/senior/plugin/1.index.html#_3-事件钩子" class="sidebar-link">3.事件钩子</a></li><li class="sidebar-sub-header"><a href="/web-webpack/senior/plugin/1.index.html#_4-事件钩子类型" class="sidebar-link">4.事件钩子类型</a></li></ul></li><li><a href="/web-webpack/senior/plugin/2.extend.html" class="sidebar-link">二.plugin 的实现</a></li><li><a href="/web-webpack/senior/plugin/3.componentCommunication.html" class="sidebar-link">三.plugin 的实现</a></li><li><a href="/web-webpack/senior/plugin/4.render.html" class="sidebar-link">四.plugin 的实现</a></li><li><a href="/web-webpack/senior/plugin/5.api.html" class="sidebar-link">五.plugin 的实现</a></li><li><a href="/web-webpack/senior/plugin/6.form.html" class="sidebar-link">六.plugin 的实现</a></li><li><a href="/web-webpack/senior/plugin/7.checkBox.html" class="sidebar-link">七.plugin 的实现</a></li><li><a href="/web-webpack/senior/plugin/8.active.html" class="sidebar-link">八.plugin 的实现</a></li><li><a href="/web-webpack/senior/plugin/9.alert.html" class="sidebar-link">九.plugin的实现</a></li><li><a href="/web-webpack/senior/plugin/10.table.html" class="sidebar-link">十.plugin的实现</a></li><li><a href="/web-webpack/senior/plugin/11.tree.html" class="sidebar-link">十一.plugin的实现</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="一-plugin的实现"><a href="#一-plugin的实现" class="header-anchor">#</a> 一.plugin的实现</h1> <p>当我们需要一个构建功能时 webpack 本身暂未支持的，我们便可以通过寻找合适的 webpack 插件来帮助实现需要的功能，或者开发一个 webpack 插件来满足项目的构建需求。</p> <h2 id="_1-一个简单的-plugin"><a href="#_1-一个简单的-plugin" class="header-anchor">#</a> 1.一个简单的 plugin</h2> <p>plugin 的实现可以是一个类，使用时传入相关配置来创建一个实例，然后放到配置的<code>plugins</code>字段中，而 plugin 实例中最重要的方法是<code>apply</code>,该方法在 webpack compiler 安装插件时会被调用一次，<code>apply</code>接受 webpack compiler 对象实例的引用，你可以在 compiler 对象实例上注册各种事件钩子函数，来影响 webpack 的所有构建流程，以便完成更多其他的构建任务。</p> <p>下边的这个例子，是一个可以创建 webpack 构建温江列表 markdown 的 plugin,实现上相对简单，但呈现了一个 webpack plugin 的基本形态。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">class</span> <span class="token class-name">FileIsPlugin</span> <span class="token punctuation">{</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>emit<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">&quot;FileIsPlugin&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">compilation</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token comment">// 在compiler的emit hook中注册一个方法，当webpack执行到这个阶段时会调用这个方法</span>
      <span class="token keyword">var</span> filelist <span class="token operator">=</span> <span class="token string">&quot;In this build:\n\n&quot;</span> <span class="token comment">// 给生成的markdown文件创建一个简单标题</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> filename <span class="token keyword">in</span> compilation<span class="token punctuation">.</span>assets<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        filelist <span class="token operator">+=</span> <span class="token string">&quot;- &quot;</span> <span class="token operator">+</span> filename <span class="token operator">+</span> <span class="token string">&quot;\n&quot;</span> <span class="token comment">// 遍历所有编译后的资源，每一个文件添加一行说明</span>
      <span class="token punctuation">}</span>
      compilation<span class="token punctuation">.</span>assets<span class="token punctuation">[</span><span class="token string">&quot;filelist.md&quot;</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token comment">// 将列表作为一个新的文件资源插入到webpack构建结果中</span>
        <span class="token function-variable function">source</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> filelist
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token function-variable function">size</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> tilelist<span class="token punctuation">.</span>length
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> FileListPlugin
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h2 id="_2-开发和调试"><a href="#_2-开发和调试" class="header-anchor">#</a> 2.开发和调试</h2> <p>创建一个 js 代码文件，在 webpack 配置文件中引用这个文件的代码，照样运行 webpack 构建查看结果即可。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> FileIsPlugin <span class="token operator">=</span> <span class="token function">requrie</span><span class="token punctuation">(</span><span class="token string">&quot;./plugins/FileIsPlugin.js&quot;</span><span class="token punctuation">)</span> <span class="token comment">// 假如我们上述那个例子的代码是 ./plugins/FileIsPlugin这个文件</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">FileIsPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 实例化这个插件，有的时候需要传入对应的配置</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h2 id="_3-事件钩子"><a href="#_3-事件钩子" class="header-anchor">#</a> 3.事件钩子</h2> <p>webpack 中的事件钩子，基本覆盖了 webpack 构建流程中的每一个步骤，你可以在这些步骤中注册自己的处理函数，来添加额外的功能。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">this</span><span class="token punctuation">.</span>hooks <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token literal-property property">shouldEmit</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">SyncBaiHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;compilation&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">//这里的声明的事件钩子函数接收的参数是</span>
  compilation<span class="token punctuation">,</span>
  <span class="token literal-property property">done</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">AsyncSeriesHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;stats&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">//这里接受的参数是stats,以此类推</span>
  <span class="token literal-property property">additionalPass</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">AsyncSeriesHOok</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token literal-property property">beforeRun</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">AsyncSeriesHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;compilation&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token literal-property property">run</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">AsyncSeriesHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;compilation&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token literal-property property">emit</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">AsyncSeriesHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;compilation&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token literal-property property">afterEmit</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">AsyncSeriesHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;compilation&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token literal-property property">thisCompilations</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">SyncHook</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">&quot;compilation&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;params&quot;</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>从这你可以看到各个事件钩子函数接收的参数是什么，你还会发现事件钩子会有不同的类型，例如<code>SyncBaiHook</code>,<code>AsyncSeriesHook</code>,<code>SyncHook</code>。</p> <h2 id="_4-事件钩子类型"><a href="#_4-事件钩子类型" class="header-anchor">#</a> 4.事件钩子类型</h2> <p>上述提到的 webpack compiler 中使用了多种类型的事件钩子，根据其名称可以区分出是同步还是异步，对于通不过的事件钩子来说，注册事件的方法只有<code>tap</code>可用，例如上述<code>shouldEmit</code>应该这样注册事件函数的：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token function">apply</span><span class="token punctuation">(</span><span class="token parameter">compiler</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>shouldEmit<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">'PluginName'</span><span class="token punctuation">,</span><span class="token punctuation">(</span><span class="token parameter">compilation</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token operator">...</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>但如果是异步的事件钩子，那么可以使用<code>tabPromise</code>或者<code>tabAsync</code>来注册事件函数，<code>tabPromise</code>要求方法返回<code>Promise</code>以便处理异步，而<code>tapAsync</code>则是需要用<code>callback</code>来返回结构，例如：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>done<span class="token punctuation">.</span><span class="token function">tapPromise</span><span class="token punctuation">(</span><span class="token string">&quot;PluginName&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">state</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Promise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    fs<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span><span class="token string">&quot;path/to/file&quot;</span><span class="token punctuation">,</span> stats<span class="token punctuation">.</span><span class="token function">toJson</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
      err <span class="token operator">?</span> <span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 或者</span>
compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>done<span class="token punctuation">.</span><span class="token function">tapAsync</span><span class="token punctuation">(</span><span class="token string">&quot;PluginName&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">stats<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  fs<span class="token punctuation">.</span><span class="token function">writeFile</span><span class="token punctuation">(</span><span class="token string">&quot;path/to/file&quot;</span><span class="token punctuation">,</span> stats<span class="token punctuation">.</span><span class="token function">toJson</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">callback</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 如果插件处理中没有异步操作要求的话，也可以用同步的方式</span>
compiler<span class="token punctuation">.</span>hooks<span class="token punctuation">.</span>done<span class="token punctuation">.</span><span class="token function">tap</span><span class="token punctuation">(</span><span class="token string">&quot;PluginName&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">stats<span class="token punctuation">,</span> callback</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">callback</span><span class="token punctuation">(</span>fa<span class="token punctuation">.</span><span class="token function">writeFileSync</span><span class="token punctuation">(</span><span class="token string">&quot;path/to/file&quot;</span><span class="token punctuation">,</span> stats<span class="token punctuation">.</span><span class="token function">toJson</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><p>然而 tabable 这个工具库提供的钩子类型远不止这几种，多样化的钩子类型，主要是为了能够覆盖多种使用场景：</p> <ul><li>连续地执行注册的事件函数</li> <li>并行的执行注册的事件函数</li> <li>一个接一个地执行注册的事件函数，从前边的事件函数获取输入，即瀑布流的方式</li> <li>异步地执行注册的事件函数</li> <li>在允许时停止执行注册的事件函数，一旦一个方法返回了一个非<code>undefined</code>的值，就跳出执行流</li></ul> <p>除了同步和异步的区别，我们再参考上述这一些使用场景，以及官方文档的 Plugin API，进一步将事件钩子类型做一个区分。
名称带有<code>parallel</code>的，注册的事件函数会并行调用，如：</p> <ul><li>AsyncParallelHook</li> <li>AsyncParallelBailHook
名称带有<code>bail</code>的，注册的事件函数会被顺序调用，直至一个处理方法有返回值（ParalleBail 的事件函数则会并行调用，第一个返回值会被使用）</li> <li>SyncBailHook</li> <li>AsyncParalleBailHook
通过上面的名称可以看出，有一些类型是可以结合到一起的，如<code>AsyncParalleBailHook</code>，这样它就具备了更加多样化的特性。</li></ul></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/zhoubichuan/web-webpack/edit/master/src/senior/plugin/1.index.md" target="_blank" rel="noopener noreferrer">在github上编辑此页</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2021/10/10上午4:12:22</span></div></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/web-webpack/senior/plugin/2.extend.html">
        二.plugin 的实现
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/web-webpack/assets/js/app.a2f8f17b.js" defer></script><script src="/web-webpack/assets/js/2.3b648fd0.js" defer></script><script src="/web-webpack/assets/js/56.854608ed.js" defer></script><script src="/web-webpack/assets/js/3.7ee031b5.js" defer></script>
  </body>
</html>
