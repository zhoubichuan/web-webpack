<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>七.配置 loader | webpack笔记</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="个人总结的vuepress学习技术文档-语法">
    <meta name="keywords" content="vuepress,最新技术文档,vuepress语法,markdown语法">
    
    <link rel="preload" href="/web-webpack/assets/css/0.styles.b291645a.css" as="style"><link rel="preload" href="/web-webpack/assets/js/app.cab6ba0a.js" as="script"><link rel="preload" href="/web-webpack/assets/js/2.19fdd78e.js" as="script"><link rel="preload" href="/web-webpack/assets/js/25.6fa65399.js" as="script"><link rel="preload" href="/web-webpack/assets/js/3.f4917027.js" as="script"><link rel="prefetch" href="/web-webpack/assets/js/10.fc0dd0ce.js"><link rel="prefetch" href="/web-webpack/assets/js/11.9e8cae2e.js"><link rel="prefetch" href="/web-webpack/assets/js/12.ee0265c0.js"><link rel="prefetch" href="/web-webpack/assets/js/13.586bc2c2.js"><link rel="prefetch" href="/web-webpack/assets/js/14.8ada40b2.js"><link rel="prefetch" href="/web-webpack/assets/js/15.1f87cf13.js"><link rel="prefetch" href="/web-webpack/assets/js/16.ee0e3ff5.js"><link rel="prefetch" href="/web-webpack/assets/js/17.ebd27048.js"><link rel="prefetch" href="/web-webpack/assets/js/18.f8a9a021.js"><link rel="prefetch" href="/web-webpack/assets/js/19.f12cd120.js"><link rel="prefetch" href="/web-webpack/assets/js/20.975d7012.js"><link rel="prefetch" href="/web-webpack/assets/js/21.295409f8.js"><link rel="prefetch" href="/web-webpack/assets/js/22.9ea9463c.js"><link rel="prefetch" href="/web-webpack/assets/js/23.e3d4a256.js"><link rel="prefetch" href="/web-webpack/assets/js/24.0d7e16da.js"><link rel="prefetch" href="/web-webpack/assets/js/26.34d73837.js"><link rel="prefetch" href="/web-webpack/assets/js/27.8d78d5b4.js"><link rel="prefetch" href="/web-webpack/assets/js/28.bf54b697.js"><link rel="prefetch" href="/web-webpack/assets/js/29.c3e3c44a.js"><link rel="prefetch" href="/web-webpack/assets/js/30.c24ed1e5.js"><link rel="prefetch" href="/web-webpack/assets/js/31.2436b2b0.js"><link rel="prefetch" href="/web-webpack/assets/js/32.0d1dc058.js"><link rel="prefetch" href="/web-webpack/assets/js/33.d35cf34f.js"><link rel="prefetch" href="/web-webpack/assets/js/34.45e3e7e6.js"><link rel="prefetch" href="/web-webpack/assets/js/35.d0dcc0ed.js"><link rel="prefetch" href="/web-webpack/assets/js/36.e5e50c59.js"><link rel="prefetch" href="/web-webpack/assets/js/37.ef90aecf.js"><link rel="prefetch" href="/web-webpack/assets/js/38.a90fb34c.js"><link rel="prefetch" href="/web-webpack/assets/js/39.22a44fa5.js"><link rel="prefetch" href="/web-webpack/assets/js/4.1befc5f8.js"><link rel="prefetch" href="/web-webpack/assets/js/40.7fa73060.js"><link rel="prefetch" href="/web-webpack/assets/js/41.12108c44.js"><link rel="prefetch" href="/web-webpack/assets/js/42.98b56a7b.js"><link rel="prefetch" href="/web-webpack/assets/js/43.522f326c.js"><link rel="prefetch" href="/web-webpack/assets/js/44.1eb33ab8.js"><link rel="prefetch" href="/web-webpack/assets/js/45.dd43042d.js"><link rel="prefetch" href="/web-webpack/assets/js/46.c3ad2dd6.js"><link rel="prefetch" href="/web-webpack/assets/js/47.8ccb63c5.js"><link rel="prefetch" href="/web-webpack/assets/js/48.906810a3.js"><link rel="prefetch" href="/web-webpack/assets/js/49.76377b2c.js"><link rel="prefetch" href="/web-webpack/assets/js/5.017b63b0.js"><link rel="prefetch" href="/web-webpack/assets/js/50.3e55df02.js"><link rel="prefetch" href="/web-webpack/assets/js/51.1fa0d1a9.js"><link rel="prefetch" href="/web-webpack/assets/js/52.a9e7abf1.js"><link rel="prefetch" href="/web-webpack/assets/js/53.4a8df62a.js"><link rel="prefetch" href="/web-webpack/assets/js/54.8027d95c.js"><link rel="prefetch" href="/web-webpack/assets/js/55.4eca3afd.js"><link rel="prefetch" href="/web-webpack/assets/js/56.e2666c1b.js"><link rel="prefetch" href="/web-webpack/assets/js/57.7bbb4083.js"><link rel="prefetch" href="/web-webpack/assets/js/58.f35592ee.js"><link rel="prefetch" href="/web-webpack/assets/js/59.88fa2f07.js"><link rel="prefetch" href="/web-webpack/assets/js/6.15ddbe3f.js"><link rel="prefetch" href="/web-webpack/assets/js/60.c2301e49.js"><link rel="prefetch" href="/web-webpack/assets/js/61.bc687f5e.js"><link rel="prefetch" href="/web-webpack/assets/js/62.951559b4.js"><link rel="prefetch" href="/web-webpack/assets/js/63.5edb8663.js"><link rel="prefetch" href="/web-webpack/assets/js/64.f3591302.js"><link rel="prefetch" href="/web-webpack/assets/js/65.d138cad5.js"><link rel="prefetch" href="/web-webpack/assets/js/66.16d081fd.js"><link rel="prefetch" href="/web-webpack/assets/js/67.2976a4a9.js"><link rel="prefetch" href="/web-webpack/assets/js/68.30ae0ab0.js"><link rel="prefetch" href="/web-webpack/assets/js/69.7ac6954c.js"><link rel="prefetch" href="/web-webpack/assets/js/7.32d08a1e.js"><link rel="prefetch" href="/web-webpack/assets/js/70.564f445d.js"><link rel="prefetch" href="/web-webpack/assets/js/71.ae8458ad.js"><link rel="prefetch" href="/web-webpack/assets/js/72.964b7e7f.js"><link rel="prefetch" href="/web-webpack/assets/js/73.fadd253d.js"><link rel="prefetch" href="/web-webpack/assets/js/74.68577e62.js"><link rel="prefetch" href="/web-webpack/assets/js/75.108e8394.js"><link rel="prefetch" href="/web-webpack/assets/js/76.369ec831.js"><link rel="prefetch" href="/web-webpack/assets/js/77.87bc5a93.js"><link rel="prefetch" href="/web-webpack/assets/js/78.21a4c3f2.js"><link rel="prefetch" href="/web-webpack/assets/js/79.62232597.js"><link rel="prefetch" href="/web-webpack/assets/js/8.50967fa7.js"><link rel="prefetch" href="/web-webpack/assets/js/80.478ab027.js"><link rel="prefetch" href="/web-webpack/assets/js/81.87ec3b38.js"><link rel="prefetch" href="/web-webpack/assets/js/82.8b1431c0.js"><link rel="prefetch" href="/web-webpack/assets/js/83.bb61544a.js"><link rel="prefetch" href="/web-webpack/assets/js/84.096e9ecf.js"><link rel="prefetch" href="/web-webpack/assets/js/85.2c41876b.js"><link rel="prefetch" href="/web-webpack/assets/js/86.2d90ba87.js"><link rel="prefetch" href="/web-webpack/assets/js/87.5d21eaf8.js"><link rel="prefetch" href="/web-webpack/assets/js/88.49295afd.js"><link rel="prefetch" href="/web-webpack/assets/js/89.a37ea9ac.js"><link rel="prefetch" href="/web-webpack/assets/js/9.a6e05753.js"><link rel="prefetch" href="/web-webpack/assets/js/90.cc2b04fd.js"><link rel="prefetch" href="/web-webpack/assets/js/91.eff88e59.js"><link rel="prefetch" href="/web-webpack/assets/js/92.c95ee3d4.js"><link rel="prefetch" href="/web-webpack/assets/js/93.f7fdc5b5.js"><link rel="prefetch" href="/web-webpack/assets/js/94.deeb75fa.js"><link rel="prefetch" href="/web-webpack/assets/js/95.007a1f0e.js"><link rel="prefetch" href="/web-webpack/assets/js/96.9b5304a3.js"><link rel="prefetch" href="/web-webpack/assets/js/97.a01c7670.js"><link rel="prefetch" href="/web-webpack/assets/js/98.2c5eeb9e.js">
    <link rel="stylesheet" href="/web-webpack/assets/css/0.styles.b291645a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/web-webpack/" class="home-link router-link-active"><!----> <span class="site-name">webpack笔记</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="基础知识" class="dropdown-title"><span class="title">基础知识</span> <span class="arrow down"></span></button> <button type="button" aria-label="基础知识" class="mobile-dropdown-title"><span class="title">基础知识</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/web-webpack/base/function/1.index.html" class="nav-link">
  一.基础功能
</a></li><li class="dropdown-item"><!----> <a href="/web-webpack/base/config/1.打包多页应用.html" class="nav-link">
  二.常见配置
</a></li><li class="dropdown-item"><!----> <a href="/web-webpack/base/plugin/1.index.html" class="nav-link">
  三.plugin使用
</a></li><li class="dropdown-item"><!----> <a href="/web-webpack/base/loader/1.index.html" class="nav-link">
  四.loader使用
</a></li><li class="dropdown-item"><!----> <a href="/web-webpack/base/optimize/1.noParse.html" class="nav-link">
  五.性能优化
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="高级知识" class="dropdown-title"><span class="title">高级知识</span> <span class="arrow down"></span></button> <button type="button" aria-label="高级知识" class="mobile-dropdown-title"><span class="title">高级知识</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/web-webpack/senior/loader/1.index.html" class="nav-link">
  一.loader实现
</a></li><li class="dropdown-item"><!----> <a href="/web-webpack/senior/plugin/1.index.html" class="nav-link">
  二.plugin实现
</a></li><li class="dropdown-item"><!----> <a href="/web-webpack/senior/tapable/1.index.html" class="nav-link">
  三.tapable实现
</a></li><li class="dropdown-item"><!----> <a href="/web-webpack/senior/write/1.writeByHand.html" class="nav-link">
  四.webpack简易实现
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="源码知识" class="dropdown-title"><span class="title">源码知识</span> <span class="arrow down"></span></button> <button type="button" aria-label="源码知识" class="mobile-dropdown-title"><span class="title">源码知识</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/web-webpack/source/webpack/1.index.html" class="nav-link">
  一.webpack源码解析
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="基础知识" class="dropdown-title"><span class="title">基础知识</span> <span class="arrow down"></span></button> <button type="button" aria-label="基础知识" class="mobile-dropdown-title"><span class="title">基础知识</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/web-webpack/base/function/1.index.html" class="nav-link">
  一.基础功能
</a></li><li class="dropdown-item"><!----> <a href="/web-webpack/base/config/1.打包多页应用.html" class="nav-link">
  二.常见配置
</a></li><li class="dropdown-item"><!----> <a href="/web-webpack/base/plugin/1.index.html" class="nav-link">
  三.plugin使用
</a></li><li class="dropdown-item"><!----> <a href="/web-webpack/base/loader/1.index.html" class="nav-link">
  四.loader使用
</a></li><li class="dropdown-item"><!----> <a href="/web-webpack/base/optimize/1.noParse.html" class="nav-link">
  五.性能优化
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="高级知识" class="dropdown-title"><span class="title">高级知识</span> <span class="arrow down"></span></button> <button type="button" aria-label="高级知识" class="mobile-dropdown-title"><span class="title">高级知识</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/web-webpack/senior/loader/1.index.html" class="nav-link">
  一.loader实现
</a></li><li class="dropdown-item"><!----> <a href="/web-webpack/senior/plugin/1.index.html" class="nav-link">
  二.plugin实现
</a></li><li class="dropdown-item"><!----> <a href="/web-webpack/senior/tapable/1.index.html" class="nav-link">
  三.tapable实现
</a></li><li class="dropdown-item"><!----> <a href="/web-webpack/senior/write/1.writeByHand.html" class="nav-link">
  四.webpack简易实现
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="源码知识" class="dropdown-title"><span class="title">源码知识</span> <span class="arrow down"></span></button> <button type="button" aria-label="源码知识" class="mobile-dropdown-title"><span class="title">源码知识</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/web-webpack/source/webpack/1.index.html" class="nav-link">
  一.webpack源码解析
</a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/web-webpack/base/function/1.index.html" class="sidebar-link">一.Webpack 入门</a></li><li><a href="/web-webpack/base/function/2.build.html" class="sidebar-link">二.打包相关配置</a></li><li><a href="/web-webpack/base/function/2.route.html" class="sidebar-link">三.路径相关配置</a></li><li><a href="/web-webpack/base/function/3.devenv.html" class="sidebar-link">四.开发环境搭建</a></li><li><a href="/web-webpack/base/function/4.devserver.html" class="sidebar-link">五.webpack-dev-server</a></li><li><a href="/web-webpack/base/function/5.envconfig.html" class="sidebar-link">六.环境相关配置</a></li><li><a href="/web-webpack/base/function/6.loaderconfig.html" aria-current="page" class="active sidebar-link">七.配置 loader</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/web-webpack/base/function/6.loaderconfig.html#_1-loader-匹配规则" class="sidebar-link">1.loader 匹配规则</a></li><li class="sidebar-sub-header"><a href="/web-webpack/base/function/6.loaderconfig.html#_2-规则条件配置" class="sidebar-link">2.规则条件配置</a></li><li class="sidebar-sub-header"><a href="/web-webpack/base/function/6.loaderconfig.html#_3-module-type" class="sidebar-link">3.module type</a></li><li class="sidebar-sub-header"><a href="/web-webpack/base/function/6.loaderconfig.html#_4-使用-loader-配置" class="sidebar-link">4.使用 loader 配置</a></li><li class="sidebar-sub-header"><a href="/web-webpack/base/function/6.loaderconfig.html#_5-loader-应用顺序" class="sidebar-link">5.loader 应用顺序</a></li><li class="sidebar-sub-header"><a href="/web-webpack/base/function/6.loaderconfig.html#_6-使用-noparse" class="sidebar-link">6.使用 noParse</a></li></ul></li><li><a href="/web-webpack/base/function/7.处理js语法及校验.html" class="sidebar-link">八.处理 js 语法及校验</a></li><li><a href="/web-webpack/base/function/7.pluginconfig.html" class="sidebar-link">九.使用 plugin</a></li><li><a href="/web-webpack/base/function/8.全局变量引入问题.html" class="sidebar-link">十.全局变量引入</a></li><li><a href="/web-webpack/base/function/8.workflow.html" class="sidebar-link">十一.内部工作流程</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="七-配置-loader"><a href="#七-配置-loader" class="header-anchor">#</a> 七.配置 loader</h1> <h2 id="_1-loader-匹配规则"><a href="#_1-loader-匹配规则" class="header-anchor">#</a> 1.loader 匹配规则</h2> <p>当我们需要配置 loader 时，都是在 <code>module.rules</code> 中添加新的配置项，在该字段中，每一项被视为一条匹配使用 loader 的规则。</p> <p>先来看一个基础的例子：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.jsx?</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token comment">// 条件</span>
        include<span class="token operator">:</span> <span class="token punctuation">[</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;src&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 条件</span>
        use<span class="token operator">:</span> <span class="token string">&quot;babel-loader&quot;</span><span class="token punctuation">,</span> <span class="token comment">// 规则应用结果</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 一个 object 即一条规则</span>
      <span class="token comment">// ...</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>loader 的匹配规则中有两个最关键的因素：一个是匹配条件，一个是匹配规则后的应用。</p> <p>匹配条件通常都使用请求资源文件的绝对路径来进行匹配，在官方文档中称为 <code>resource</code>，除此之外还有比较少用到的 <code>issuer</code>，则是声明依赖请求的源文件的绝对路径。举个例子：在 /path/to/app.js 中声明引入 <code>import './src/style.scss'</code>，<code>resource</code> 是 /path/to/src/style.scss，<code>issuer</code> 是 /path/to/app.js，规则条件会对这两个值来尝试匹配。</p> <p>上述代码中的 <code>test</code> 和 <code>include</code> 都用于匹配 <code>resource</code> 路径，是 <code>resource.test</code> 和 <code>resource.include</code> 的简写，你也可以这么配置：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  rules<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      resource<span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token comment">// resource 的匹配条件</span>
        test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.jsx?</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
        include<span class="token operator">:</span> <span class="token punctuation">[</span>path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">&quot;src&quot;</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token comment">// 如果要使用 issuer 匹配，便是 issuer: { test: ... }</span>
      use<span class="token operator">:</span> <span class="token string">&quot;babel-loader&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><blockquote><p>issuer 规则匹配的场景比较少见，你可以用它来尝试约束某些类型的文件中只能引用某些类型的文件。</p></blockquote> <p>当规则的条件匹配时，便会使用对应的 loader 配置，如上述例子中的 <code>babel-loader</code>。关于 loader 配置后面再详细介绍，这里先来看看如何配置更加复杂的规则匹配条件。</p> <h2 id="_2-规则条件配置"><a href="#_2-规则条件配置" class="header-anchor">#</a> 2.规则条件配置</h2> <p>大多数情况下，配置 loader 的匹配条件时，只要使用 <code>test</code> 字段就好了，很多时候都只需要匹配文件后缀名来决定使用什么 loader，但也不排除在某些特殊场景下，我们需要配置比较复杂的匹配条件。webpack 的规则提供了多种配置形式：</p> <ul><li><code>{ test: ... }</code> 匹配特定条件</li> <li><code>{ include: ... }</code> 匹配特定路径</li> <li><code>{ exclude: ... }</code> 排除特定路径</li> <li><code>{ and: [...] }</code>必须匹配数组中所有条件</li> <li><code>{ or: [...] }</code> 匹配数组中任意一个条件</li> <li><code>{ not: [...] }</code> 排除匹配数组中所有条件</li></ul> <p>上述的所谓条件的值可以是：</p> <ul><li>字符串：必须以提供的字符串开始，所以是字符串的话，这里我们需要提供绝对路径</li> <li>正则表达式：调用正则的 <code>test</code> 方法来判断匹配</li> <li>函数：(path) =&gt; boolean，返回 <code>true</code> 表示匹配</li> <li>数组：至少包含一个条件的数组</li> <li>对象：匹配所有属性值的条件</li></ul> <p>通过例子来帮助理解：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>rules<span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.jsx?</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token comment">// 正则</span>
    include<span class="token operator">:</span> <span class="token punctuation">[</span>
      path<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span>__dirname<span class="token punctuation">,</span> <span class="token string">'src'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment">// 字符串，注意是绝对路径</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// 数组</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    test<span class="token operator">:</span> <span class="token punctuation">{</span>
      js<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.js</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
      jsx<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.jsx</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 对象，不建议使用</span>
    not<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> <span class="token comment">/* ... */</span> <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 函数，通常需要高度自定义时才会使用</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>上述多个配置形式结合起来就能够基本满足各种各样的构建场景了，通常我们会结合使用 <code>test/and</code> 和 <code>include&amp;exclude</code> 来配置条件，如上述那个简单的例子。</p> <h2 id="_3-module-type"><a href="#_3-module-type" class="header-anchor">#</a> 3.module type</h2> <p>webpack 4.x 版本强化了 module type，即模块类型的概念，不同的模块类型类似于配置了不同的 loader，webpack 会有针对性地进行处理，现阶段实现了以下 5 种模块类型。</p> <ul><li><code>javascript/auto</code>：即 webpack 3 默认的类型，支持现有的各种 JS 代码模块类型 —— CommonJS、AMD、ESM</li> <li><code>javascript/esm</code>：ECMAScript modules，其他模块系统，例如 CommonJS 或者 AMD 等不支持，是 <code>.mjs</code> 文件的默认类型</li> <li><code>javascript/dynamic</code>：CommonJS 和 AMD，排除 ESM</li> <li><code>javascript/json</code>：JSON 格式数据，<code>require</code> 或者 <code>import</code> 都可以引入，是 <code>.json</code> 文件的默认类型</li> <li><code>webassembly/experimental</code>：WebAssembly modules，当前还处于试验阶段，是 <code>.wasm</code> 文件的默认类型</li></ul> <p>如果不希望使用默认的类型的话，在确定好匹配规则条件时，我们可以使用 <code>type</code> 字段来指定模块类型，例如把所有的 JS 代码文件都设置为强制使用 ESM 类型：</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  test<span class="token operator">:</span> /\.js/<span class="token punctuation">,</span>
  include<span class="token operator">:</span> <span class="token punctuation">[</span>
    path.resolve(__dirname<span class="token punctuation">,</span> 'src')<span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  type<span class="token operator">:</span> 'javascript/esm'<span class="token punctuation">,</span> <span class="token comment">// 这里指定模块类型</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>上述做法是可以帮助你规范整个项目的模块系统，但是如果遗留太多不同类型的模块代码时，建议还是直接使用默认的 <code>javascript/auto</code>。</p> <p>webpack 后续的开发计划会增加对更多模块类型的支持，例如极其常见的 CSS 和 HTML 模块类型，这个特性值得我们期待一下。</p> <h2 id="_4-使用-loader-配置"><a href="#_4-使用-loader-配置" class="header-anchor">#</a> 4.使用 loader 配置</h2> <p>当然，在当前版本的 webpack 中，<code>module.rules</code> 的匹配规则最重要的还是用于配置 loader，我们可以使用 <code>use</code> 字段：</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>rules<span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    test<span class="token operator">:</span> /\.less/<span class="token punctuation">,</span>
    use<span class="token operator">:</span> <span class="token punctuation">[</span>
      'style-loader'<span class="token punctuation">,</span> <span class="token comment">// 直接使用字符串表示 loader</span>
      <span class="token punctuation">{</span>
        loader<span class="token operator">:</span> 'css-loader'<span class="token punctuation">,</span>
        options<span class="token operator">:</span> <span class="token punctuation">{</span>
          importLoaders<span class="token operator">:</span> <span class="token number">1</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 用对象表示 loader，可以传递 loader 配置等</span>
      <span class="token punctuation">{</span>
        loader<span class="token operator">:</span> 'less-loader'<span class="token punctuation">,</span>
        options<span class="token operator">:</span> <span class="token punctuation">{</span>
          noIeCompat<span class="token operator">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// 传递 loader 配置</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><p>我们看下上述的例子，先忽略 loader 的使用情况，单纯看看如何配置。<code>use</code> 字段可以是一个数组，也可以是一个字符串或者表示 loader 的对象。如果只需要一个 loader，也可以这样：<code>use: { loader: 'babel-loader', options: { ... } }</code>。</p> <p>我们还可以使用 <code>options</code> 给对应的 loader 传递一些配置项，这里不再展开。当你使用一些 loader 时，loader 的说明一般都有相关配置的描述。</p> <h2 id="_5-loader-应用顺序"><a href="#_5-loader-应用顺序" class="header-anchor">#</a> 5.loader 应用顺序</h2> <p>前面提到，一个匹配规则中可以配置使用多个 loader，即一个模块文件可以经过多个 loader 的转换处理，执行顺序是从最后配置的 loader 开始，一步步往前。例如，对于上面的 <code>less</code> 规则配置，一个 style.less 文件会途径 less-loader、css-loader、style-loader 处理，成为一个可以打包的模块。</p> <p>loader 的应用顺序在配置多个 loader 一起工作时很重要，通常会使用在 CSS 配置上，除了 style-loader 和 css-loader，你可能还要配置 less-loader 然后再加个 postcss 的 autoprefixer 等。</p> <p>上述从后到前的顺序是在同一个 rule 中进行的，那如果多个 rule 匹配了同一个模块文件，loader 的应用顺序又是怎样的呢？看一份这样的配置：</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>rules<span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    test<span class="token operator">:</span> /\.js$/<span class="token punctuation">,</span>
    exclude<span class="token operator">:</span> /node_modules/<span class="token punctuation">,</span>
    loader<span class="token operator">:</span> <span class="token string">&quot;eslint-loader&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    test<span class="token operator">:</span> /\.js$/<span class="token punctuation">,</span>
    exclude<span class="token operator">:</span> /node_modules/<span class="token punctuation">,</span>
    loader<span class="token operator">:</span> <span class="token string">&quot;babel-loader&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">,</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>这样无法法保证 eslint-loader 在 babel-loader 应用前执行。webpack 在 <code>rules</code> 中提供了一个 <code>enforce</code> 的字段来配置当前 rule 的 loader 类型，没配置的话是普通类型，我们可以配置 <code>pre</code> 或 <code>post</code>，分别对应前置类型或后置类型的 loader。</p> <blockquote><p>eslint-loader 要检查的是人工编写的代码，如果在 babel-loader 之后使用，那么检查的是 Babel 转换后的代码，所以必须在 babel-loader 处理之前使用。</p></blockquote> <p>还有一种行内 loader，即我们在应用代码中引用依赖时直接声明使用的 loader，如 <code>const json = require('json-loader!./file.json')</code> 这种。不建议在应用开发中使用这种 loader，后续我们还会再提到。</p> <p>顾名思义，所有的 loader 按照<strong>前置 -&gt; 行内 -&gt; 普通 -&gt; 后置</strong>的顺序执行。所以当我们要确保 eslint-loader 在 babel-loader 之前执行时，可以如下添加 <code>enforce</code> 配置：</p> <div class="language-json line-numbers-mode"><pre class="language-json"><code>rules<span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token punctuation">{</span>
    enforce<span class="token operator">:</span> 'pre'<span class="token punctuation">,</span> <span class="token comment">// 指定为前置类型</span>
    test<span class="token operator">:</span> /\.js$/<span class="token punctuation">,</span>
    exclude<span class="token operator">:</span> /node_modules/<span class="token punctuation">,</span>
    loader<span class="token operator">:</span> <span class="token string">&quot;eslint-loader&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>当项目文件类型和应用的 loader 不是特别复杂的时候，通常建议把要应用的同一类型 loader 都写在同一个匹配规则中，这样更好维护和控制。</p> <h2 id="_6-使用-noparse"><a href="#_6-使用-noparse" class="header-anchor">#</a> 6.使用 <code>noParse</code></h2> <p>在 webpack 中，我们需要使用的 loader 是在 <code>module.rules</code> 下配置的，webpack 配置中的 module 用于控制如何处理项目中不同类型的模块。</p> <p>除了 <code>module.rules</code> 字段用于配置 loader 之外，还有一个 <code>module.noParse</code> 字段，可以用于配置哪些模块文件的内容不需要进行解析。对于一些<strong>不需要解析依赖（即无依赖）</strong> 的第三方大型类库等，可以通过这个字段来配置，以提高整体的构建速度。</p> <blockquote><p>使用 <code>noParse</code> 进行忽略的模块文件中不能使用 <code>import</code>、<code>require</code>、<code>define</code> 等导入机制。</p></blockquote> <div class="language-js line-numbers-mode"><pre class="language-js"><code>module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    noParse<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">jquery|lodash</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token comment">// 正则表达式</span>

    <span class="token comment">// 或者使用 function</span>
    <span class="token function">noParse</span><span class="token punctuation">(</span><span class="token parameter">content</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">jquery|lodash</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p><code>noParse</code> 从某种程度上说是个优化配置项，日常也可以不去使用。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/web-webpack/base/function/5.envconfig.html" class="prev">
        六.环境相关配置
      </a></span> <span class="next"><a href="/web-webpack/base/function/7.处理js语法及校验.html">
        八.处理 js 语法及校验
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----><!----></div></div>
    <script src="/web-webpack/assets/js/app.cab6ba0a.js" defer></script><script src="/web-webpack/assets/js/2.19fdd78e.js" defer></script><script src="/web-webpack/assets/js/25.6fa65399.js" defer></script><script src="/web-webpack/assets/js/3.f4917027.js" defer></script>
  </body>
</html>
